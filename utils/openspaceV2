from table import Table
import numpy as np
import openpyxl

class Openspace:

    def __init__(self, number_of_tables, seats_per_table):
        self.tables = []
        self.number_of_tables = number_of_tables
        for x in range(number_of_tables):
            self.tables.append(Table(seats_per_table))

    def organize(self, names):
        """
        Randomly assign people to Seat objects in the different Table objects.
        """
        np.random.shuffle(names)
        for name in names:
            assigned = False
            for table in self.tables:
                if table.has_free_spot():
                    table.assign_seat(name)
                    assigned = True
                    break
            if not assigned:
                print(f"Could not assign seat to {name}: no free spots available.")

    def display(self):
        """
        Display the different tables and their occupants in a readable way.
        """
        n_tables = 0
        for table in self.tables:
            n_tables += 1
            print(f"Table number {n_tables} has:")
            for seat in table.seats:
                print(seat.occupant)
                occupant = seat.occupant
                self.store(occupant)
    
    def store(self, newRecord):
        """
        Store the repartition in an Excel file.
        """
        # Create a new workbook or load an existing one if you want to append
        workbook = openpyxl.Workbook()
        sheet = workbook.active

        # Find the next empty row
        max_row = sheet.max_row
        sheet[f'A{max_row + 1}'] = newRecord

        # Save the workbook
        workbook.save('names.xlsx')

        print("Name saved successfully.")
